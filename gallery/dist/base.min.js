function loadFile(t,i){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?i.apply(e):console.log("Error",e.statusText))},e.open("GET",t,!0),e.send(null)}var res,tag_list={};Object.keys||(Object.keys=function(t){if(t!==Object(t))throw new TypeError("Object.keys called on a non-object");var i,e=[];for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}),loadFile("./dist/gallery_info.json",function(){res=JSON.parse(this.responseText),console.log(res.name+": "+res.description),console.log("Author: "+res.author);for(var t,i=res.content.length,e=0;e<i;e++){var n=Math.floor(res.content[e].date/1e4);n<=2012&&(n="~2012"),n+="",tag_list[n]?tag_list[n].push(e):tag_list[n]=[e],res.content[e].tags.forEach(function(t){tag_list[t]?tag_list[t].push(e):tag_list[t]=[e]})}t=Object.keys(tag_list);var s={template:'<div id="photos" @click="changeView($event)">\t\t\t\t<figure v-for="item in items" :id="item.id">\t\t\t\t\t<img :src="(!! lazylist && lazylist[item.id]) ?  stupid : item.path" :class="{blankimg: (!! lazylist && lazylist[item.id])}" :ref="stupidPrefix + item.id">\t\t\t\t\t<aside><span>{{item.desc}}</span></aside>\t\t\t\t</figure>\t\t\t</div>',props:["factors"],data:function(){return{lazylist:Array.apply(null,new Array(i)).map(function(){return!0}),stupid:"./assets/img/blank.jpg",stupidPrefix:"i_"}},mounted:function(){this.lazyload(),window.addEventListener("scroll",this.lazyload),window.addEventListener("resize",this.lazyload)},methods:{changeView:function(t){this.$emit("toinfo",t.target.parentElement.id)},lazyload:function(t){if([]!==this.lazylist){var i=(window.innerHeight||document.documentElement.clientHeight)+(document.documentElement.scrollTop||document.body.scrollTop||window.pageYOffset),e=this;this.items.forEach(function(t){if(0!=e.lazylist[t.id]){var n=e.$refs["i_"+t.id][0];n.parentElement.offsetTop<i&&e.lazylist.splice(t.id,1,!1)}}),-1==this.lazylist.indexOf(!0)&&(this.lazylist=[])}}},computed:{items:function(){var e,n=[],s={},o=Array.apply(null,Array(i)).map(function(t,i){return i});this.factors.forEach(function(i){e=t.filter(function(t){return t.search(i)!=-1}).reduce(function(t,i){return t.concat(tag_list[i])},[]),o=_.intersection(e,o),[]==o});for(var r=0,a=o.length;r<a;r++)void 0==s[o[r]]&&(s[o[r]]=1,n.push({id:o[r],desc:res.content[o[r]].info,path:"./assets/img/"+o[r]+"."+res.content[o[r]].type}));return n}},watch:{items:function(t){if([]!==this.lazylist){var i=this;t.forEach(function(t){i.lazylist.splice(t.id,1,!1)})}}}},o={template:'<div id="display" :style="{top: scrolltop}">\t\t\t\t<aside @click="quit" @touchend="quit">×</aside>\t\t\t\t<figure><img :src="path"></figure>\t\t\t\t<div id="imginfo">\t\t\t\t\t<p><span class="vertical-center">{{info}}</span></p>\t\t\t\t\t<div id="imgtags" @touchend="chooseTag($event)" @click="chooseTag($event)">\t\t\t\t\t\t<span v-for="tag in tags">{{tag}}</span>\t\t\t\t\t</div>\t\t\t\t\t<div id="imgrelated" class="clearfix" @touchend="choosePic($event)" @click="choosePic($event)">\t\t\t\t\t\t<div>相似的图片：</div>\t\t\t\t\t\t<img v-for="relate in relates" :src="relate.path" :id="relate.id">\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t</div>',data:function(){return{scrolltop:"50px",id:this.pid}},props:["pid"],created:function(){var t=void 0!==window.pageXOffset,i="CSS1Compat"===(document.compatMode||""),e=t?window.pageYOffset:i?document.documentElement.scrollTop:document.body.scrollTop;this.scrolltop=Math.max(50,e)+"px"},methods:{chooseTag:function(t){this.$emit("revisetag",t.target.innerHTML)},choosePic:function(t){var i=parseInt(t.target.id);i>=0&&(this.id=i)},quit:function(){this.$emit("revisetag")}},computed:{path:function(){return"./assets/img/"+this.id+"."+res.content[this.id].type},info:function(){return res.content[this.id].info},tags:function(){return res.content[this.id].tags},relates:function(){for(var t=this.tags,i=[parseInt(this.id)],e=0;e<4;e++){for(var n=tag_list[t[_.random(t.length-1)]],s=_.random(n.length-1),o=0;i.indexOf(n[s])!=-1;)if(n=tag_list[t[_.random(t.length-1)]],s=_.random(n.length-1),o++,o>20)return i.shift(),i.map(function(t){return"./assets/img/"+t+"."+res.content[t].type});i.push(n[s])}return i.shift(),i.map(function(t){return{path:"./assets/img/"+t+"."+res.content[t].type,id:t}})}}};new Vue({data:{filter:"",pid:0,currView:"picwall"},mounted:function(){var t=Array.prototype.slice.call(document.getElementsByClassName("list-item"));t.forEach(function(i){i.addEventListener("click",function(i){if(t.forEach(function(t){t.children[1].style.display=""}),""==this.children[1].style.display?this.children[1].style.display="block":this.children[1].style.display="",!i)var i=window.event;i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation()}),i.addEventListener("touchend",function(i){if(t.forEach(function(t){t.children[1].style.display=""}),""==this.children[1].style.display?this.children[1].style.display="block":this.children[1].style.display="",!i)var i=window.event;i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation()})}),window.addEventListener("click",function(){t.forEach(function(t){t.children[1].style.display=""})}),window.addEventListener("touchend",function(){t.forEach(function(t){t.children[1].style.display=""})})},methods:{addPreface:function(){""==this.filter&&(this.filter="preface"),this.factors.indexOf("preface")==-1&&(this.filter+=",preface")},addShot:function(){""==this.filter&&(this.filter="screenshot"),this.factors.indexOf("screenshot")==-1&&(this.filter+=",screenshot")},addTag:function(t){var i=t.target.innerHTML;""==this.filter&&(this.filter=i),this.factors.indexOf(i)==-1&&(this.filter+=","+i)},toInfo:function(t){t&&(this.pid=t),this.currView="picinfo"},reviseTag:function(t){t?this.filter=t:this.currView="picwall"}},computed:{factors:function(){return this.filter.split(",",10).filter(function(t){return""!=t})}},watch:{filter:function(){this.currView="picwall"}},components:{picwall:s,picinfo:o}}).$mount("#app")});