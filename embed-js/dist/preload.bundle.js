!function(e){function t(s){if(n[s])return n[s].exports;var r=n[s]={exports:{},id:s,loaded:!1};return e[s].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";n(1)},function(e,t,n){"use strict";function s(e,t,n,s,o,a,h){var c=i.Network.mkGraph(100,.5,100,100,u.VLAN_MAX),l=new i.SubstrateN(c.nodes,c.links);l.findKShortestPaths();var f=new u.Simulation(l,e,t);f.dispatch(n,s,o,a,h),f.print(r)}function r(e,t,n,s){e!=t?$("#display_t").html(t-e):$("#display_t").html("--"),$("#display_s").html(e),$("#display_a").html(n),$("#display_r").html(s)}var i=n(2),u=n(3);$("#submit").on("click",function(e){e.preventDefault();var t=parseInt($("#vns").val())||10,n=parseInt($("#wins").val())||5,r=parseInt($("input[name=isinf]:checked","#panel").val())||1,i=parseFloat($("#linkrate").val())||.5,u=parseInt($("#cpu").val())||1,o=parseInt($("#bw").val())||1,a=parseInt($("#life").val())||3;s(t,n,r,i,u,o,a)})},function(e,t){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=function l(e){r(this,l),this.cpu=e,this.usage=[]},o=function f(e,t,n,s){r(this,f),this.src=e,this.dst=t,this.bw=n,this.vlan=s,this.usage=[]},a=function(){function e(t,n){r(this,e),this.nodes=t,this.links=n,this.nodes.forEach(function(e,t){e.id=t}),this.links.forEach(function(e,t){e.id=t})}return i(e,[{key:"sum_nodes",get:function(){return this.nodes.length}},{key:"sum_links",get:function(){return this.links.length}}],[{key:"mkGraph",value:function(e,t,n,s,r){for(var i=[],a=[],h=0;h<e;h++){var c=new u(Math.random()*n);i.push(c)}var l=new o(0,1,Math.random()*s,r);a.push(l);for(var f=2;f<i.length;f++){for(var d=!0,p=0;p<f;p++)if(Math.random()<=t){var v=new o(p,f,Math.random()*s,r);a.push(v),d=!1}if(d){var k=Math.floor(Math.random()*f);k==f&&(k-=1);var w=new o(k,f,Math.random()*s,r);a.push(w)}}var y={nodes:i,links:a};return y}}]),e}(),h=function(e){function t(e,s,i,u){r(this,t);var o=n(this,Object.getPrototypeOf(t).call(this,s,i));return o.id=e,o.state="R",o.tryCounts=0,o.life=u||1,o.revenue=o.nodes.reduce(function(e,t){return e+t.cpu},0)+o.links.reduce(function(e,t){return e+t.bw+1},0),o}return s(t,e),t}(a),c=function(e){function t(){return r(this,t),n(this,Object.getPrototypeOf(t).apply(this,arguments))}return s(t,e),i(t,[{key:"getMaxWeightedNode",value:function(e,t){var n=this,s=new Array(this.sum_nodes).fill(0);this.links.forEach(function(e){s[e.src]+=e.bw,s[e.dst]+=e.bw}),this.nodes.forEach(function(e,t){s[t]*=e.cpu});var r={id:-1,value:0};return s.forEach(function(s,i){n.nodes[i].cpu>=t&&s>r.value&&n.nodes[i].usage.indexOf(e)==-1&&(r.id=i,r.value=s)}),r.id}},{key:"alterNodeResource",value:function(e,t,n,s){if("add"===n){this.nodes[e].cpu+=t;var r=this.nodes[e].usage.indexOf(s);r!=-1&&this.nodes[e].usage.splice(r,1)}else{if("sub"!==n)throw new Error("Unknown alter node resource type!");if(this.nodes[e].cpu<t)throw new Error("Node "+e+" CPU is not enough!");this.nodes[e].cpu-=t,this.nodes[e].usage.push(s)}}},{key:"alterLinksResource",value:function(e,t,n,s){var r=this;if("add"===n)e.forEach(function(e){r.links[e].bw+=t,r.links[e].vlan+=1,r.links[e].usage.splice(r.links[e].usage.indexOf(s),1)});else{if("sub"!==n)throw new Error("Unknown alter links resource type!");if(!e.every(function(e){return r.links[e].bw>=t&&r.links[e].vlan>0}))throw new Error("Link resource not met!");e.forEach(function(e){r.links[e].bw-=t,r.links[e].vlan-=1,r.links[e].usage.push(s)})}}},{key:"findKShortestPaths",value:function(){var e=this,t=[];this.paths=[];for(var n=0;n<this.sum_nodes;n++){t.push(new Array(this.sum_nodes)),this.paths.push(new Array(this.sum_nodes));for(var s=0;s<this.sum_nodes;s++)n==s?(t[n][s]=0,this.paths[n][s]=s):(t[n][s]=1e4,this.paths[n][s]=-1)}this.links.forEach(function(n){n.src>=0&&n.dst>=0&&(t[n.src][n.dst]=1,t[n.dst][n.src]=1,e.paths[n.src][n.dst]=n.dst,e.paths[n.dst][n.src]=n.src)});for(var r=0;r<this.sum_nodes;r++)for(var i=0;i<this.sum_nodes;i++)for(var u=0;u<this.sum_nodes;u++)i!=r&&u!=r&&i!=u&&t[i][r]+t[r][u]<t[i][u]&&(t[i][u]=t[i][r]+t[r][u],this.paths[i][u]=this.paths[i][r])}}]),t}(a);t.Network=a,t.VirtualN=h,t.SubstrateN=c},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Simulation=t.VLAN_MAX=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i=n(2),u=4096,o=2,a=3,h=function(){function e(t,n,r){s(this,e),this.sn=t,this.vnsPerWin=n,this.windows=r,this.counter=0,this.currSum=0,this.succRev=0,this.succCos=0,this.succSum=0,this.failSum=0,this.readyQueue=[],this.postpQueue=[],this.inQueue=[]}return r(e,[{key:"mapNode",value:function(e){var t=this,n=this.readyQueue[e];if("R"!=n.state)throw new Error("Wrong state("+n.state+") of request "+n.id+"in ready queue.");for(var s=0,r=n.nodes.length;s<r;s++){var i=n.nodes[s],u=this.sn.getMaxWeightedNode(n.id,i.cpu);if(u<0||i.cpu>this.sn.nodes[u].cpu)return n.nodes.forEach(function(e){e.usage.length>0&&t.sn.alterNodeResource(e.usage[0],e.cpu,"add",n.id)}),n.tryCounts<o&&(n.tryCounts+=1,this.postpQueue.push(n),n.state="P"),this.readyQueue.splice(e,1),-1;i.usage.push(u),this.sn.alterNodeResource(u,i.cpu,"sub",n.id)}return n.state="NF",0}},{key:"mapLink2Steps",value:function(e,t){var n=this,s=this.readyQueue[e],r=[],i=0,u=0,a=this.sn;if("NF"!=s.state)throw new Error("Wrong state("+s.state+") of request "+s.id+"in ready queue.");for(var h=function(e,t){var a=s.links[e],h=s.nodes[a.src].usage[0],c=s.nodes[a.dst].usage[0];r=[];for(var l=function(){var e=n.sn.paths[h][c];return e==-1?(i=2,"break"):(f=n.sn.links.findIndex(function(t){return t.src==h&&t.dst==e||t.src==e&&t.dst==h}),f==-1||n.sn.links[f].bw<a.bw||n.sn.links[f].vlan<1?(i=1,"break"):(r.push(f),void(h=e)))};h!=c;){var d=l();if("break"===d)break}if(1==i)for(;1==i;){r=[],n.sn.links[f].src=-1,n.sn.links[f].dst=-1,n.sn.findKShortestPaths(),h=s.nodes[a.src].usage[0],i=0;for(var p=function(){var e=n.sn.paths[h][c];return e==-1?(i=2,"break"):(f=n.sn.links.findIndex(function(t){return t.src==h&&t.dst==e||t.src==e&&t.dst==h}),f==-1||n.sn.links[f].bw<a.bw||n.sn.links[f].vlan<1?(i=1,"break"):(r.push(f),void(h=e)))};h!=c;){var v=p();if("break"===v)break}}if(0==i)u+=a.bw*(r.length-1),console.log("Alter link resources for VN "+s.id),n.sn.alterLinksResource(r,a.bw,"sub",s.id);else if(2==i)return s.nodes.forEach(function(e){if(0==e.usage.length)throw new Error("Node resource error in link resource releasing.");n.sn.alterNodeResource(e.usage[0],e.cpu,"add",s.id)}),s.links.forEach(function(e){e.usage.length>0&&n.sn.alterLinksResource(e.usage,e.bw,"add",s.id)}),s.tryCounts<o&&(s.tryCounts+=1,n.postpQueue.push(s),s.state="P"),"break"},c=0,l=s.links.length;c<l;c++){var f,f,d=h(c,l);if("break"===d)break}return this.sn=a,0==i?(this.succRev+=s.revenue,this.succCos+=u+s.revenue,this.succSum+=1,s.state="LF",0):-1}},{key:"dispatch",value:function(e,t,n,s,r){var o=this,h=Math.min(this.windows,1e3);console.log("Total time windows: "+h);for(var c=0;c<h;c++){if(console.log("Time window No."+(c+1)),!e)for(var l=0;l<this.inQueue.length;l++)this.inQueue[l].life<=c&&!function(){var e=o.inQueue[l];if("LF"!=e.state)throw new Error("Uncorrect state in inQueue!");console.log("Release resources of request "+e.id),e.nodesforEach(function(t){if(0==t.usage.length)throw new Error("Node resource error in link resource releasing.");o.sn.alterNodeResource(t.usage[0],t.cpu,"add",e.id)}),e.links.forEach(function(t){t.usage.length>0&&o.sn.alterLinksResource(t.usage,t.bw,"add",e.id)}),o.inQueue.splice(l,1)}();for(;0!=this.postpQueue.length;){var f=this.postpQueue.pop();f.state="R",this.readyQueue.push(f),this.failSum-=1}for(var d=Math.floor(Math.random()*(this.vnsPerWin+1)+1*this.vnsPerWin/2),p=0;p<d;p++){var v=Math.floor(7*Math.random()+a),k=i.Network.mkGraph(v,t,n,s,u),w=e?0:c+1+Math.floor(Math.random()*r),y=new i.VirtualN(this.counter,k.nodes,k.links,w);this.counter++,this.readyQueue.push(y)}for(this.readyQueue.sort(function(e,t){return t.revenue-e.revenue});this.readyQueue.length>0;){if("R"!=this.readyQueue[0].state)throw new Error("Request in ready queue with uncorrect state: "+this.readyQueue[0].state);0!=this.mapNode(0)?this.failSum+=1:0==this.mapLink2Steps(0,e)?e||this.inQueue.push(this.readyQueue[0]):this.failSum+=1,this.currSum+=1,this.readyQueue.shift()}}}},{key:"print",value:function(e){e(this.counter,this.currSum,this.calcAR(),this.calcRC())}},{key:"calcRC",value:function(){return this.succRev/this.succCos}},{key:"calcAR",value:function(){return 1-this.failSum/this.counter}}]),e}();t.VLAN_MAX=u,t.Simulation=h}]);